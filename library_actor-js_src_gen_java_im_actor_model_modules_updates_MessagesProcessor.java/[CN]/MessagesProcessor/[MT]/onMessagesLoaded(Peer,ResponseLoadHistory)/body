{
  ArrayList<Message> messages=new ArrayList<Message>();
  long maxLoadedDate=Long.MAX_VALUE;
  for (  HistoryMessage historyMessage : historyResponse.getHistory()) {
    maxLoadedDate=Math.min(historyMessage.getDate(),maxLoadedDate);
    AbsContent content=EntityConverter.convert(historyMessage.getMessage());
    if (content == null) {
      continue;
    }
    MessageState state=EntityConverter.convert(historyMessage.getState());
    messages.add(new Message(historyMessage.getRid(),historyMessage.getDate(),historyMessage.getDate(),historyMessage.getSenderUid(),state,content));
  }
  if (messages.size() > 0) {
    conversationActor(peer).send(new ConversationActor.HistoryLoaded(messages));
  }
  conversationHistoryActor(peer).send(new ConversationHistoryActor.LoadedMore(historyResponse.getHistory().size(),maxLoadedDate));
}
