{
  if (rid != currentChangeTask) {
    return;
  }
  request(new RequestEditAvatar(new im.actor.model.api.FileLocation(fileReference.getFileId(),fileReference.getAccessHash())),new RpcCallback<ResponseEditAvatar>(){
    @Override public void onResult(    ResponseEditAvatar response){
      updates().onUpdateReceived(new SeqUpdate(response.getSeq(),response.getState(),UpdateUserAvatarChanged.HEADER,new UpdateUserAvatarChanged(myUid(),response.getAvatar()).toByteArray()));
      updates().onUpdateReceived(new ExecuteAfter(response.getSeq(),new Runnable(){
        @Override public void run(){
          self().send(new AvatarChanged(rid));
        }
      }
));
    }
    @Override public void onError(    RpcException e){
      if (rid != currentChangeTask) {
        return;
      }
      currentChangeTask=0;
      modules().getProfile().getOwnAvatarVM().getUploadState().change(new AvatarUploadState(null,false));
    }
  }
);
}
