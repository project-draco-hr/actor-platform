{
  Peer peer=convert(_peer);
  if (content instanceof ApiEncryptedMessage) {
    context().getEncryption().getMessageEncryptor().send(new MessageEncryptionActor.InMessage(peer,date,senderUid,rid,(ApiEncryptedMessage)content));
  }
  AbsContent msgContent;
  try {
    msgContent=AbsContent.fromMessage(content);
  }
 catch (  IOException e) {
    e.printStackTrace();
    return;
  }
  boolean isOut=myUid() == senderUid;
  Message message=new Message(rid,date,date,senderUid,isOut ? MessageState.SENT : MessageState.UNKNOWN,msgContent,new ArrayList<Reaction>());
  conversationActor(peer).send(message);
  if (!isOut) {
    plainReceiveActor().send(new CursorReceiverActor.MarkReceived(peer,date));
    ownReadActor().send(new OwnReadActor.InMessage(peer,message));
    msgContent.onIncoming(peer,context());
  }
 else {
    ownReadActor().send(new OwnReadActor.OutMessage(peer,message.getSortDate()));
  }
}
