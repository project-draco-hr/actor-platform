{
  if (requestCode == REQUEST_GALLERY && resultCode == Activity.RESULT_OK) {
    tempAvatarPath=AppContext.getInternalTempFile("avatar","jpg");
    new Crop(data.getData()).output(Uri.fromFile(new File(tempAvatarPath))).asSquare().start(this);
    return;
  }
 else   if (requestCode == REQUEST_PHOTO && resultCode == Activity.RESULT_OK) {
    tempAvatarPath=AppContext.getInternalTempFile("avatar","jpg");
    new Crop(Uri.fromFile(new File(externalFile))).output(Uri.fromFile(new File(tempAvatarPath))).asSquare().start(this);
    return;
  }
 else   if (requestCode == Crop.REQUEST_CROP && resultCode == Activity.RESULT_OK) {
    setResult(RESULT_OK,new Intent().putExtra(Intents.EXTRA_RESULT,Intents.RESULT_IMAGE).putExtra(Intents.EXTRA_IMAGE,tempAvatarPath));
    finish();
    return;
  }
  setResult(RESULT_CANCELED);
  finish();
}
