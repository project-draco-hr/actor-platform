{
  digest.update(input,0,input.length / 2);
  Digest copy1=cloneDigest(((EncodableDigest)digest).getEncodedState());
  Digest copy2=cloneDigest(((EncodableDigest)copy1).getEncodedState());
  digest.update(input,input.length / 2,input.length - input.length / 2);
  digest.doFinal(resBuf,0);
  if (!areEqual(expected,resBuf)) {
    fail("failing state vector test",expected,new String(Hex.encode(resBuf)));
  }
  copy1.update(input,input.length / 2,input.length - input.length / 2);
  copy1.doFinal(resBuf,0);
  if (!areEqual(expected,resBuf)) {
    fail("failing state copy1 vector test",expected,new String(Hex.encode(resBuf)));
  }
  copy2.update(input,input.length / 2,input.length - input.length / 2);
  copy2.doFinal(resBuf,0);
  if (!areEqual(expected,resBuf)) {
    fail("failing state copy2 vector test",expected,new String(Hex.encode(resBuf)));
  }
}
