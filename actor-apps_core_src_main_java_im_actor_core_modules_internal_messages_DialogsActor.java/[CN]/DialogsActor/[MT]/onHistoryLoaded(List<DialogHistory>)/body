{
  ArrayList<Dialog> updated=new ArrayList<Dialog>();
  for (  DialogHistory dialogHistory : history) {
    if (dialogs.getValue(dialogHistory.getPeer().getUnuqueId()) != null) {
      continue;
    }
    PeerDesc peerDesc=buildPeerDesc(dialogHistory.getPeer());
    if (peerDesc == null) {
      continue;
    }
    ContentDescription description=ContentDescription.fromContent(dialogHistory.getContent());
    updated.add(new Dialog(dialogHistory.getPeer(),dialogHistory.getSortDate(),peerDesc.getTitle(),peerDesc.getAvatar(),dialogHistory.getUnreadCount(),dialogHistory.getRid(),description.getContentType(),description.getText(),dialogHistory.getStatus(),dialogHistory.getSenderId(),dialogHistory.getDate(),description.getRelatedUser()));
  }
  addOrUpdateItems(updated);
  updateSearch(updated);
  context().getAppStateModule().onDialogsLoaded();
  notifyState(true);
}
