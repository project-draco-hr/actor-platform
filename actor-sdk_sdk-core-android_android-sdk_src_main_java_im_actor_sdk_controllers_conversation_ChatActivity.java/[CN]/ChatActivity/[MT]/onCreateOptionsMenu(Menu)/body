{
  this.menu=menu;
  getMenuInflater().inflate(R.menu.chat_menu,menu);
  if (peer.getPeerType() == PeerType.PRIVATE) {
    menu.findItem(R.id.contact).setVisible(true);
  }
 else {
    menu.findItem(R.id.contact).setVisible(false);
  }
  if (peer.getPeerType() == PeerType.GROUP) {
    if (groups().get(peer.getPeerId()).isMember().get()) {
      menu.findItem(R.id.leaveGroup).setVisible(true);
      menu.findItem(R.id.groupInfo).setVisible(true);
    }
 else {
      menu.findItem(R.id.leaveGroup).setVisible(false);
      menu.findItem(R.id.groupInfo).setVisible(false);
    }
  }
 else {
    menu.findItem(R.id.groupInfo).setVisible(false);
    menu.findItem(R.id.leaveGroup).setVisible(false);
  }
  boolean callsEnabled=ActorSDK.sharedActor().isCallsEnabled();
  if (callsEnabled) {
    if (peer.getPeerType() == PeerType.PRIVATE) {
      callsEnabled=!users().get(peer.getPeerId()).isBot();
    }
 else     if (peer.getPeerType() == PeerType.GROUP) {
      callsEnabled=groups().get(peer.getPeerId()).getMembersCount() <= MAX_USERS_FOR_CALLS;
    }
  }
  menu.findItem(R.id.call).setVisible(callsEnabled);
  menu.findItem(R.id.video_call).setVisible(callsEnabled);
  if (peer.getPeerType() == PeerType.PRIVATE) {
    bind(users().get(peer.getPeerId()).isContact(),new ValueChangedListener<Boolean>(){
      @Override public void onChanged(      Boolean val,      Value<Boolean> valueModel){
        menu.findItem(R.id.add_to_contacts).setVisible(!val);
        invalidateOptionsMenu();
      }
    }
);
  }
  menu.findItem(R.id.files).setVisible(false);
  return super.onCreateOptionsMenu(menu);
}
