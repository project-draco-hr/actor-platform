{
  peer=Peer.fromUniqueId(getIntent().getExtras().getLong(EXTRA_CHAT_PEER));
  if (saveInstance == null) {
    isCompose=getIntent().getExtras().getBoolean(EXTRA_CHAT_COMPOSE,false);
  }
 else {
    pending_fileName=saveInstance.getString(STATE_FILE_NAME,null);
  }
  super.onCreate(saveInstance);
  messageEditText.addTextChangedListener(new TextWatcherImp());
  SLIDE_LIMIT=(int)(Screen.getDensity() * 180);
  audioContainer=findViewById(R.id.audioContainer);
  audioTimer=(TextView)findViewById(R.id.audioTimer);
  audioSlide=findViewById(R.id.audioSlide);
  recordPoint=findViewById(R.id.record_point);
  ActorSystem.system().addDispatcher("voice_capture_dispatcher");
  audioButton=(ImageView)findViewById(R.id.record_btn);
  audioButton.setVisibility(View.VISIBLE);
  audioButton.setOnTouchListener(new View.OnTouchListener(){
    @Override public boolean onTouch(    View v,    MotionEvent event){
      if (event.getAction() == MotionEvent.ACTION_DOWN) {
        if (!isAudioVisible) {
          showAudio();
          slideStart=(int)event.getX();
        }
      }
 else       if (event.getAction() == MotionEvent.ACTION_UP) {
        if (isAudioVisible) {
          hideAudio(false);
        }
      }
 else       if (event.getAction() == MotionEvent.ACTION_MOVE) {
        if (isAudioVisible) {
          int slide=slideStart - (int)event.getX();
          if (slide < 0) {
            slide=0;
          }
          if (slide > SLIDE_LIMIT) {
            hideAudio(true);
          }
 else {
            slideAudio(slide);
          }
        }
      }
      return true;
    }
  }
);
  mentionsList=(ListView)findViewById(R.id.mentionsList);
  quoteContainer=(FrameLayout)findViewById(R.id.quoteContainer);
  quoteText=(TextView)findViewById(R.id.quote_text);
  findViewById(R.id.ib_close_quote).setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      goneView(quoteContainer);
      quoteText.setText("");
      currentQuote="";
    }
  }
);
  sendUri=getIntent().getStringExtra("send_uri");
  sendUriMultiple=getIntent().getStringArrayListExtra("send_uri_multiple");
  shareUser=getIntent().getIntExtra("share_user",0);
  forwardText=getIntent().getStringExtra("forward_text");
  forwardTextRaw=getIntent().getStringExtra("forward_text_raw");
  sendText=getIntent().getStringExtra("send_text");
  forwardDocDescriptor=getIntent().getStringExtra("forward_doc_descriptor");
  forwardDocIsDoc=getIntent().getBooleanExtra("forward_doc_is_doc",true);
}
