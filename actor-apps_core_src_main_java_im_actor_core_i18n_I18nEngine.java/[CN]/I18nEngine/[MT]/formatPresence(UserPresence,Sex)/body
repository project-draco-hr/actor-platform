{
  if (value == null) {
    Log.d(TAG,"formatPresence: null");
    return null;
  }
  Log.d(TAG,"formatPresence: " + value.getState() + ": "+ value.getLastSeen());
  if (value.getState() == UserPresence.State.OFFLINE) {
    long currentTime=im.actor.runtime.Runtime.getCurrentSyncedTime() / 1000L;
    Log.d(TAG,"formatPresence: time:" + currentTime);
    int delta=(int)(currentTime - value.getLastSeen());
    Log.d(TAG,"formatPresence: delta:" + delta);
    if (delta < 60) {
      Log.d(TAG,"formatPresence: onlineNow");
      if (locale.containsKey("OnlineNowMale") && locale.containsKey("OnlineNowFemale")) {
        return sex == Sex.UNKNOWN ? locale.get("OnlineNow") : sex == Sex.MALE ? locale.get("OnlineNowMale") : locale.get("OnlineNowFemale");
      }
 else {
        return locale.get("OnlineNow");
      }
    }
 else     if (delta < 24 * 60 * 60) {
      String time=formatTime(value.getLastSeen() * 1000L);
      Log.d(TAG,"formatPresence: today " + time);
      if (areSameDays(value.getLastSeen() * 1000L,new Date().getTime())) {
        if (locale.containsKey("OnlineLastSeenTodayMale") && locale.containsKey("OnlineLastSeenTodayMale")) {
          return (sex == Sex.UNKNOWN ? locale.get("OnlineLastSeenToday") : sex == Sex.MALE ? locale.get("OnlineLastSeenTodayMale") : locale.get("OnlineLastSeenTodayFemale")).replace("{time}",time);
        }
 else {
          return locale.get("OnlineLastSeenToday").replace("{time}",time);
        }
      }
 else {
        if (locale.containsKey("OnlineLastSeenYesterdayMale") && locale.containsKey("OnlineLastSeenYesterdayMale")) {
          return (sex == Sex.UNKNOWN ? locale.get("OnlineLastSeenYesterday") : sex == Sex.MALE ? locale.get("OnlineLastSeenYesterdayMale") : locale.get("OnlineLastSeenYesterdayFemale")).replace("{time}",time);
        }
 else {
          return locale.get("OnlineLastSeenYesterday").replace("{time}",time);
        }
      }
    }
 else     if (delta < 14 * 24 * 60* 60) {
      String time=formatTime(value.getLastSeen() * 1000L);
      String date=formatDate(value.getLastSeen() * 1000L);
      Log.d(TAG,"formatPresence: datetime " + date + " "+ time);
      if (locale.containsKey("OnlineLastSeenDateTimeMale") && locale.containsKey("OnlineLastSeenDateTimeMale")) {
        return (sex == Sex.UNKNOWN ? locale.get("OnlineLastSeenDateTime") : sex == Sex.MALE ? locale.get("OnlineLastSeenDateTimeMale") : locale.get("OnlineLastSeenDateTimeFemale")).replace("{time}",time).replace("{date}",date);
      }
 else {
        return locale.get("OnlineLastSeenDateTime").replace("{time}",time).replace("{date}",date);
      }
    }
 else     if (delta < 6 * 30 * 24* 60* 60) {
      String date=formatDate(value.getLastSeen() * 1000L);
      Log.d(TAG,"formatPresence: date " + date);
      if (locale.containsKey("OnlineLastSeenDateMale") && locale.containsKey("OnlineLastSeenDateMale")) {
        return (sex == Sex.UNKNOWN ? locale.get("OnlineLastSeenDate") : sex == Sex.MALE ? locale.get("OnlineLastSeenDateMale") : locale.get("OnlineLastSeenDateFemale")).replace("{date}",date);
      }
 else {
        return locale.get("OnlineLastSeenDate").replace("{date}",date);
      }
    }
 else {
      Log.d(TAG,"formatPresence: offline");
      return locale.get("OnlineOff");
    }
  }
 else   if (value.getState() == UserPresence.State.ONLINE) {
    Log.d(TAG,"formatPresence: online");
    return locale.get("OnlineOn");
  }
  Log.d(TAG,"formatPresence: null");
  return null;
}
