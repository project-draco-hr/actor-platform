{
  Message message=messages.getValue(rid);
  if (message == null) {
    return;
  }
  if (content instanceof TextContent) {
    content.setUpdatedHash(((TextContent)content).getText().hashCode());
  }
  Message updatedMsg=message.changeContent(content);
  messages.addOrUpdateItem(updatedMsg);
  if (updatedMsg.getContent() instanceof DocumentContent) {
    docs.addOrUpdateItem(updatedMsg);
  }
 else {
    docs.removeItem(rid);
  }
  if (delegate != null) {
    delegate.onUpdate(updatedMsg);
  }
  if (!isHiddenPeer) {
    dialogsActor.send(new DialogsActor.MessageContentChanged(peer,rid,content));
  }
}
