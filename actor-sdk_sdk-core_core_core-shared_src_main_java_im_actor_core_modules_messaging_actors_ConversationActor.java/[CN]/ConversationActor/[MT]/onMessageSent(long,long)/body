{
  Message msg=messages.getValue(rid);
  if (msg != null && (msg.getMessageState() == MessageState.PENDING)) {
    MessageState messageState;
    if (date <= state.getOutReadDate()) {
      messageState=MessageState.READ;
    }
 else     if (date <= state.getOutReceiveState()) {
      messageState=MessageState.RECEIVED;
    }
 else {
      messageState=MessageState.SENT;
    }
    Message updatedMsg=msg.changeAllDate(date).changeState(messageState);
    messages.addOrUpdateItem(updatedMsg);
    if (updatedMsg.getContent() instanceof DocumentContent) {
      docs.addOrUpdateItem(updatedMsg);
    }
    if (!isHiddenPeer) {
      dialogsActor.send(new DialogsActor.InMessage(peer,updatedMsg,inPendingIndex.getCount()));
      if (dialogsGroupedActor != null) {
        dialogsGroupedActor.send(new ActiveDialogsActor.CounterChanged(peer,inPendingIndex.getCount()));
      }
    }
  }
}
