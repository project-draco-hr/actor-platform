{
  messages.addOrUpdateItem(message);
  if (message.isOnServer()) {
    if (message.getSenderId() != myUid()) {
      if (message.getSortDate() > state.getInMaxMessageDate()) {
        state=state.changeInMaxDate(message.getSortDate());
        conversationState.addOrUpdateItem(state);
      }
      if (message.getSortDate() > state.getInReadDate()) {
        inPendingIndex.put(message.getRid(),message.getDate());
      }
    }
    if (isConversationAutoRead()) {
      checkReadState(false);
    }
    if (!isHiddenPeer) {
      dialogsActor.send(new DialogsActor.InMessage(peer,message,inPendingIndex.getCount()));
    }
    if (dialogsGroupedActor != null) {
      dialogsGroupedActor.send(new ActiveDialogsActor.CounterChanged(peer,inPendingIndex.getCount()));
    }
  }
}
