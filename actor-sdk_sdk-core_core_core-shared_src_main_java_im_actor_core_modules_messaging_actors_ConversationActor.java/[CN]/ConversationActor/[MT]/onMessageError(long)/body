{
  Message msg=messages.getValue(rid);
  if (msg != null && msg.isPendingOrSent()) {
    Message updatedMsg=msg.changeState(MessageState.ERROR);
    messages.addOrUpdateItem(updatedMsg);
    if (updatedMsg.getContent() instanceof DocumentContent) {
      docs.addOrUpdateItem(updatedMsg);
    }
    if (!isHiddenPeer) {
      dialogsActor.send(new DialogsActor.MessageStateChanged(peer,rid,MessageState.ERROR));
    }
    if (dialogsGroupedActor != null) {
      dialogsGroupedActor.send(new GroupedDialogsActor.CounterChanged(peer,inPendingIndex.getCount()));
    }
  }
}
