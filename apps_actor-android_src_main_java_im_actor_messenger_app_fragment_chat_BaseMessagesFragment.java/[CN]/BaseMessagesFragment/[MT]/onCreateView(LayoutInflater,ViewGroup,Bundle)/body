{
  try {
    peer=Peer.fromBytes(getArguments().getByteArray("EXTRA_PEER"));
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  View res=inflate(inflater,container,R.layout.fragment_messages,messenger().getMessagesGlobalList(peer));
  View footer=new View(getActivity());
  footer.setLayoutParams(new RecyclerView.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,Screen.dp(8)));
  addHeaderView(footer);
  View header=new View(getActivity());
  header.setLayoutParams(new RecyclerView.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,Screen.dp(64)));
  addFooterView(header);
  conversationVM=messenger().buildConversationVM(peer,getDisplayList(),new ConversationVMCallback(){
    @Override public void onLoaded(    long unreadId,    final int index){
      if (messagesAdapter != null) {
        messagesAdapter.setFirstUnread(unreadId);
      }
      if (index > 0) {
        linearLayoutManager.scrollToPositionWithOffset(index + 1,Screen.dp(64));
      }
 else {
        getCollection().scrollToPosition(0);
      }
    }
  }
);
  return res;
}
