{
  DialogSpec spec=new DialogSpec(peer,false,counter);
  specs.getEngine().addOrUpdateItem(spec);
  if (peer.getPeerType() == PeerType.GROUP) {
    if (getGroup(peer.getPeerId()).isHidden()) {
      return;
    }
  }
  boolean found=false;
  for (  Peer p : storage.getPrivatePeers()) {
    if (p.equals(peer)) {
      found=true;
      break;
    }
  }
  for (  Peer p : storage.getGroupPeers()) {
    if (p.equals(peer)) {
      found=true;
      break;
    }
  }
  if (!found) {
    if (peer.getPeerType() == PeerType.PRIVATE) {
      storage.getPrivatePeers().add(peer);
    }
 else     if (peer.getPeerType() == PeerType.GROUP) {
      storage.getGroupPeers().add(peer);
    }
 else {
      return;
    }
  }
  notifyVM();
  saveStorage();
}
