{
  for (  MDText text : texts) {
    if (text instanceof MDRawText) {
      builder.append(((MDRawText)text).getRawText());
    }
 else     if (text instanceof MDSpan) {
      MDSpan span=(MDSpan)text;
      int start=builder.length();
      writeText(span.getChild(),builder);
      Object spanObj;
      if (span.getSpanType() == MDSpan.TYPE_BOLD) {
        spanObj=new StyleSpan(Typeface.BOLD);
      }
 else {
        spanObj=new StyleSpan(Typeface.ITALIC);
      }
      builder.setSpan(spanObj,start,builder.length(),Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
    }
 else     if (text instanceof MDUrl) {
      final MDUrl url=(MDUrl)text;
      int start=builder.length();
      builder.append(url.getUrlTitle());
      builder.setSpan(new ClickableSpan(){
        @Override public void onClick(        View view){
          Context ctx=view.getContext();
          if (url.getUrl().startsWith("send:")) {
            if (ctx instanceof ChatActivity) {
              ActorSDK.sharedActor().getMessenger().sendMessage(((ChatActivity)ctx).getPeer(),url.getUrl().replace("send:",""));
            }
          }
 else {
            Intent intent=new Intent(Intent.ACTION_VIEW).setData(Uri.parse(url.getUrl()));
            Bundle b=addChromeCustomTabData(intent);
            if (intent.resolveActivity(ctx.getPackageManager()) != null) {
              ctx.startActivity(intent);
            }
 else {
              Intent WithSchema=new Intent(Intent.ACTION_VIEW).setData(Uri.parse("http://".concat(url.getUrl())));
              Bundle b1=addChromeCustomTabData(WithSchema);
              if (WithSchema.resolveActivity(ctx.getPackageManager()) != null) {
                ctx.startActivity(WithSchema);
              }
 else {
                Toast.makeText(view.getContext(),"Unknown URL type",Toast.LENGTH_SHORT).show();
              }
            }
          }
        }
      }
,start,builder.length(),Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
    }
 else {
      throw new RuntimeException("Unknown text type: " + text);
    }
  }
}
