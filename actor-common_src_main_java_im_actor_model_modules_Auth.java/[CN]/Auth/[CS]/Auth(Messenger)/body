{
  this.messenger=messenger;
  this.preferences=messenger.getConfiguration().getPreferencesStorage();
  this.mainThread=messenger.getConfiguration().getMainThread();
  deviceHash=preferences.getBytes(KEY_DEVICE_HASH);
  if (deviceHash == null) {
    deviceHash=RandomUtils.seed(32);
    preferences.putBytes(KEY_DEVICE_HASH,deviceHash);
  }
  if (preferences.getBool(KEY_AUTH,false)) {
    state=State.LOGGED_IN;
    messenger.onLoggedIn();
  }
 else {
    state=State.AUTH_START;
  }
}
