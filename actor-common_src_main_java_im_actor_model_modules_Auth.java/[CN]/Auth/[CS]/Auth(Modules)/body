{
  this.modules=modules;
  this.preferences=modules.getConfiguration().getPreferencesStorage();
  this.mainThread=modules.getConfiguration().getMainThread();
  this.myUid=preferences.getInt(KEY_AUTH_UID,0);
  deviceHash=preferences.getBytes(KEY_DEVICE_HASH);
  if (deviceHash == null) {
    deviceHash=RandomUtils.seed(32);
    preferences.putBytes(KEY_DEVICE_HASH,deviceHash);
  }
  if (preferences.getBool(KEY_AUTH,false)) {
    state=State.LOGGED_IN;
    modules.onLoggedIn();
  }
 else {
    state=State.AUTH_START;
  }
}
