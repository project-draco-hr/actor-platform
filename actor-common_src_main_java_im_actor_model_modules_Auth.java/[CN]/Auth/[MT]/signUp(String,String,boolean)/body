{
  return new Command<State>(){
    @Override public void start(    final CommandCallback<State> callback){
      modules.getActorApi().request(new RequestSignUp(preferences.getLong(KEY_PHONE,0),preferences.getString(KEY_SMS_HASH),preferences.getInt(KEY_SMS_CODE,0) + "",firstName,RandomUtils.seed(1024),deviceHash,"ActorLib",APP_ID,APP_KEY,isSilent),new RpcCallback<ResponseAuth>(){
        @Override public void onResult(        ResponseAuth response){
          preferences.putBool(KEY_AUTH,true);
          state=State.LOGGED_IN;
          myUid=response.getUser().getId();
          preferences.putInt(KEY_AUTH_UID,myUid);
          modules.onLoggedIn();
          mainThread.runOnUiThread(new Runnable(){
            @Override public void run(){
              state=State.LOGGED_IN;
              callback.onResult(state);
            }
          }
);
        }
        @Override public void onError(        final RpcException e){
          if ("PHONE_CODE_EXPIRED".equals(e.getTag())) {
            resetAuth();
          }
          mainThread.runOnUiThread(new Runnable(){
            @Override public void run(){
              callback.onError(e);
            }
          }
);
        }
      }
);
    }
  }
;
}
