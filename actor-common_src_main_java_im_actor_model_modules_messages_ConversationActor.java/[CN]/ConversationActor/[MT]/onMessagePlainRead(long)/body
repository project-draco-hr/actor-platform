{
  for (  PendingMessage p : pendingMessages.getAll()) {
    if (p.getDate() <= date) {
      Message msg=messages.getValue(p.getRid());
      if (msg != null && (msg.getMessageState() == MessageState.SENT || msg.getMessageState() == MessageState.RECEIVED)) {
        messages.addOrUpdateItem(msg.changeState(MessageState.READ));
        dialogsActor.send(new DialogsActor.MessageStateChanged(peer,p.getRid(),MessageState.READ));
      }
      pendingMessages.removeItem(p.getRid());
    }
  }
}
