{
  return new Promise<R>(){
    @Override void exec(    final PromiseResolver resolver){
      promises.then(new Consumer<Promise<T>[]>(){
        @Override public void apply(        Promise<T>[] promises1){
          final Object[] res=new Object[promises1.length];
          final Boolean[] ended=new Boolean[promises1.length];
          for (int i=0; i < promises1.length; i++) {
            final int finalI=i;
            promises1[i].then(new Consumer<T>(){
              @Override public void apply(              T t){
                res[finalI]=t;
                ended[finalI]=true;
                for (int i1=0; i1 < promises1.length; i1++) {
                  if (ended[i1] == null || !ended[i1]) {
                    return;
                  }
                }
                Promise<R> promise=fuc.apply((T[])res);
                promise.then(new Consumer<R>(){
                  @Override public void apply(                  R r){
                    resolver.result(r);
                  }
                }
);
                promise.failure(new Consumer<Exception>(){
                  @Override public void apply(                  Exception e){
                    resolver.error(e);
                  }
                }
);
                promise.done(resolver.getDispatcher());
              }
            }
);
            promises1[i].failure(new Consumer<Exception>(){
              @Override public void apply(              Exception e){
                resolver.error(e);
              }
            }
);
            promises1[i].done(resolver.getDispatcher());
          }
        }
      }
);
      promises.failure(new Consumer<Exception>(){
        @Override public void apply(        Exception e){
          resolver.error(e);
        }
      }
);
      promises.done(resolver.getDispatcher());
    }
  }
;
}
