{
  if (update instanceof DialogHistoryLoaded) {
    ResponseLoadDialogs dialogs=((DialogHistoryLoaded)update).getDialogs();
    applyRelated(dialogs.getUsers(),dialogs.getGroups(),false);
    messagesProcessor.onDialogsLoaded(dialogs);
  }
 else   if (update instanceof MessagesHistoryLoaded) {
    MessagesHistoryLoaded historyLoaded=(MessagesHistoryLoaded)update;
    applyRelated(historyLoaded.getLoadHistory().getUsers(),new ArrayList<ApiGroup>(),false);
    messagesProcessor.onMessagesLoaded(historyLoaded.getPeer(),historyLoaded.getLoadHistory());
  }
 else   if (update instanceof LoggedIn) {
    ArrayList<ApiUser> users=new ArrayList<ApiUser>();
    users.add(((LoggedIn)update).getAuth().getUser());
    applyRelated(users,new ArrayList<ApiGroup>(),true);
    runOnUiThread(((LoggedIn)update).getRunnable());
  }
 else   if (update instanceof ContactsLoaded) {
    ContactsLoaded contactsLoaded=(ContactsLoaded)update;
    applyRelated(contactsLoaded.getContacts().getUsers(),new ArrayList<ApiGroup>(),false);
    context().getContactsModule().getContactSyncActor().send(new ContactsSyncActor.ContactsLoaded(contactsLoaded.getContacts()));
  }
 else   if (update instanceof UsersFounded) {
    final UsersFounded founded=(UsersFounded)update;
    applyRelated(((UsersFounded)update).getUsers(),new ArrayList<ApiGroup>(),false);
    final ArrayList<UserVM> users=new ArrayList<UserVM>();
    for (    ApiUser u : founded.getUsers()) {
      users.add(context().getUsersModule().getUsers().get(u.getId()));
    }
    runOnUiThread(new Runnable(){
      @Override public void run(){
        founded.getCommandCallback().onResult(users.toArray(new UserVM[users.size()]));
      }
    }
);
  }
 else   if (update instanceof GroupCreated) {
    final GroupCreated created=(GroupCreated)update;
    ArrayList<ApiGroup> groups=new ArrayList<ApiGroup>();
    groups.add(created.getGroup());
    applyRelated(created.getUsers(),groups,false);
    runOnUiThread(new Runnable(){
      @Override public void run(){
        created.getCallback().onResult(created.getGroup().getId());
      }
    }
);
  }
 else   if (update instanceof RelatedResponse) {
    RelatedResponse relatedResponse=(RelatedResponse)update;
    applyRelated(relatedResponse.getRelatedUsers(),relatedResponse.getRelatedGroups(),false);
    relatedResponse.getAfterApply().run();
  }
 else   if (update instanceof StickersLoaded) {
    stickersProcessor.onOwnStickerCollectionsChanged(((StickersLoaded)update).getCollections());
  }
}
