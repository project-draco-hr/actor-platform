{
  preferences().putBool(KEY_AUTH,true);
  state=AuthState.LOGGED_IN;
  myUid=response.getUser().getId();
  preferences().putInt(KEY_AUTH_UID,myUid);
  modules().onLoggedIn();
  updates().onUpdateReceived(new LoggedIn(response,new Runnable(){
    @Override public void run(){
      state=AuthState.LOGGED_IN;
      callback.onResult(state);
      User user=modules().getUsersModule().getUsers().getValue(myUid);
      ArrayList<Long> records=new ArrayList<Long>();
      for (      ContactRecord contactRecord : user.getRecords()) {
        if (contactRecord.getRecordType() == ContactRecordType.PHONE) {
          records.add(Long.parseLong(contactRecord.getRecordData()));
        }
      }
      modules().getAnalytics().onLoggedInPerformed(CryptoUtils.hex(deviceHash),user.getUid(),records.toArray(new Long[records.size()]),user.getName());
    }
  }
));
}
