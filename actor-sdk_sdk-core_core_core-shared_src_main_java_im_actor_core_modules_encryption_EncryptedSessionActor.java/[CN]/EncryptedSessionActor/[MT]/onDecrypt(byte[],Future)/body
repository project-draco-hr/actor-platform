{
  final int keyGroupId=ByteStrings.bytesToInt(data,0);
  final long ownEphermalKey0Id=ByteStrings.bytesToLong(data,4);
  final long theirEphermalKey0Id=ByteStrings.bytesToLong(data,12);
  final byte[] ownEphermalKey=ByteStrings.substring(data,20,32);
  final byte[] theirEphermalKey=ByteStrings.substring(data,52,32);
  final int messageIndex=ByteStrings.bytesToInt(data,84);
  Log.d(TAG,"onDecrypt: " + Hex.toHex(data));
  Log.d(TAG,"onDecrypt:key group id: " + keyGroupId + ", "+ data.length);
  Log.d(TAG,"onDecrypt:ownEphermalKey0Id: " + ownEphermalKey0Id);
  Log.d(TAG,"onDecrypt:theirEphermalKey0Id: " + theirEphermalKey0Id);
  Log.d(TAG,"onDecrypt:messageIndex: " + messageIndex);
  ask(context().getEncryption().getKeyManager(),new KeyManagerActor.FetchEphemeralPrivateKey(theirEphermalKey),new AskCallback(){
    @Override public void onResult(    Object obj){
      Log.d(TAG,"onDecrypt:onResultEphermal");
      final KeyManagerActor.FetchEphemeralPrivateKeyRes ownEphermalKey=(KeyManagerActor.FetchEphemeralPrivateKeyRes)obj;
      ask(context().getEncryption().getKeyManager(),new KeyManagerActor.FetchEphemeralPrivateKeyById(theirEphermalKey0Id),new AskCallback(){
        @Override public void onResult(        Object obj){
          Log.d(TAG,"onDecrypt:onResultPrivate");
          final KeyManagerActor.FetchEphemeralPrivateKeyRes ownEphermalKey0=(KeyManagerActor.FetchEphemeralPrivateKeyRes)obj;
          ArrayList<Long> keys=new ArrayList<Long>();
          keys.add(ownEphermalKey0Id);
          request(new RequestLoadPublicKey(new ApiUserOutPeer(uid,getUser(uid).getAccessHash()),keyGroupId,keys),new RpcCallback<ResponsePublicKeys>(){
            @Override public void onResult(            ResponsePublicKeys response){
              Log.d(TAG,"onDecrypt:RequestLoadPublicKey");
              onDecrypt(data,ownEphermalKey0.getPrivateKey(),ownEphermalKey.getPrivateKey(),theirEphermalKey,response.getPublicKey().get(0).getKeyMaterial(),messageIndex,future);
            }
            @Override public void onError(            RpcException e){
              Log.d(TAG,"onDecrypt:RequestLoadPublicKey:onError");
              future.onError(e);
            }
          }
);
        }
        @Override public void onError(        Exception e){
          Log.d(TAG,"onDecrypt:onResultPrivate:onError");
          future.onError(e);
        }
      }
);
    }
    @Override public void onError(    Exception e){
      Log.d(TAG,"onDecrypt:onResultEphermal:onError");
      future.onError(e);
    }
  }
);
}
