{
  String name;
  Avatar avatar;
switch (peer.getPeerType()) {
case PRIVATE:
    User u=messenger.getUsers().getValue(peer.getPeerId());
  name=u.getName();
avatar=u.getAvatar();
break;
default :
return;
}
Dialog dialog=dialogs.getValue(peer.getUid());
ContentDescription contentDescription=new ContentDescription(message.getContent());
DialogBuilder builder=new DialogBuilder().setRid(message.getRid()).setTime(message.getTime()).setMessageType(contentDescription.getContentType()).setText(contentDescription.getText()).setRelatedUid(contentDescription.getRelatedUid()).setStatus(message.getMessageState()).setSenderId(message.getSenderId());
if (dialog != null) {
if (dialog.getSortKey() > message.getSortKey()) {
return;
}
builder.setPeer(dialog.getPeer()).setDialogTitle(dialog.getDialogTitle()).setDialogAvatar(dialog.getDialogAvatar()).setUnreadCount(dialog.getUnreadCount());
if (!contentDescription.isSilent()) {
builder.setSortKey(message.getSortKey());
}
}
 else {
if (contentDescription.isSilent()) {
return;
}
builder.setPeer(peer).setDialogTitle(name).setDialogAvatar(avatar).setUnreadCount(0).setSortKey(message.getSortKey());
}
dialogs.addOrUpdateItem(builder.createDialog());
}
