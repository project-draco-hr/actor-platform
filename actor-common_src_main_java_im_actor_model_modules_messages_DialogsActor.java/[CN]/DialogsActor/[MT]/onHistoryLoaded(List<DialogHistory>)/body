{
  ArrayList<Dialog> updated=new ArrayList<Dialog>();
  for (  DialogHistory dialogHistory : history) {
    if (dialogs.getValue(dialogHistory.getPeer().getUid()) != null) {
      continue;
    }
    PeerDesc peerDesc=buildPeerDesc(dialogHistory.getPeer());
    if (peerDesc == null) {
      continue;
    }
    ContentDescription description=new ContentDescription(dialogHistory.getContent());
    updated.add(new Dialog(dialogHistory.getPeer(),dialogHistory.getSortDate(),peerDesc.getTitle(),peerDesc.getAvatar(),dialogHistory.getUnreadCount(),dialogHistory.getRid(),description.getContentType(),description.getText(),dialogHistory.getStatus(),dialogHistory.getSenderId(),dialogHistory.getDate(),description.getRelatedUid()));
  }
  dialogs.addOrUpdateItems(updated);
}
