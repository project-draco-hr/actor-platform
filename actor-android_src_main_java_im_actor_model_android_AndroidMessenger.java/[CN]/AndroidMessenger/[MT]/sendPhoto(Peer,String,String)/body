{
  try {
    ImageMetadata metadata=new FileSource(fullFilePath).getImageMetadata();
    Bitmap bitmap=ImageLoading.loadBitmapOptimizedHQ(fullFilePath);
    Bitmap optimized=ImageRotating.fixExif(bitmap,metadata.getExifOrientation());
    Bitmap smallThumb=ImageScaling.scaleFit(optimized,90,90);
    byte[] data=ImageLoading.saveJpeg(smallThumb,ImageLoading.JPEG_QUALITY_LOW);
    String resultFileName=AppContext.getExternalTempFile("image","jpg");
    if (resultFileName == null) {
      return;
    }
    ImageLoading.save(optimized,resultFileName);
    sendPhoto(peer,fileName,optimized.getWidth(),optimized.getHeight(),new FastThumb(smallThumb.getWidth(),smallThumb.getHeight(),data),new AndroidFileSystemReference(resultFileName));
  }
 catch (  Throwable t) {
    t.printStackTrace();
  }
}
