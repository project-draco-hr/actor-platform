{
  return new Command<Boolean>(){
    @Override public void start(    CommandCallback<Boolean> callback){
      fileDownloader.execute(new Runnable(){
        @Override public void run(){
          String[] filePathColumn={MediaStore.Images.Media.DATA,MediaStore.Video.Media.MIME_TYPE,MediaStore.Video.Media.TITLE};
          String picturePath;
          String mimeType;
          String fileName;
          Cursor cursor=context.getContentResolver().query(uri,filePathColumn,null,null,null);
          if (cursor != null) {
            cursor.moveToFirst();
            picturePath=cursor.getString(cursor.getColumnIndex(filePathColumn[0]));
            mimeType=cursor.getString(cursor.getColumnIndex(filePathColumn[1]));
            fileName=cursor.getString(cursor.getColumnIndex(filePathColumn[2]));
            if (mimeType == null) {
              mimeType="?/?";
            }
            cursor.close();
          }
 else {
            picturePath=uri.getPath();
            fileName=new File(uri.getPath()).getName();
            int index=fileName.lastIndexOf(".");
            if (index > 0) {
              mimeType=MimeTypeMap.getSingleton().getMimeTypeFromExtension(fileName.substring(index + 1));
            }
 else {
              mimeType="?/?";
            }
          }
          if (picturePath == null || !uri.getScheme().equals("file")) {
            File externalFile=context.getExternalFilesDir(null);
            if (externalFile == null) {
              return;
            }
            String externalPath=externalFile.getAbsolutePath();
            File dest=new File(externalPath + "/Actor/");
            dest.mkdirs();
            File outputFile=new File(dest,"upload_" + random.nextLong() + ".jpg");
            picturePath=outputFile.getAbsolutePath();
            try {
              IOUtils.copy(context.getContentResolver().openInputStream(uri),new File(picturePath));
            }
 catch (            IOException e) {
              e.printStackTrace();
              return;
            }
          }
          if (fileName == null) {
            fileName=picturePath;
          }
          if (mimeType.startsWith("video/")) {
            sendVideo(peer,picturePath,fileName);
            trackVideoSend(peer);
          }
 else           if (mimeType.startsWith("image/")) {
            sendPhoto(peer,picturePath,new File(fileName).getName());
            trackPhotoSend(peer);
          }
 else {
            sendDocument(peer,picturePath,new File(fileName).getName());
            trackDocumentSend(peer);
          }
        }
      }
);
    }
  }
;
}
