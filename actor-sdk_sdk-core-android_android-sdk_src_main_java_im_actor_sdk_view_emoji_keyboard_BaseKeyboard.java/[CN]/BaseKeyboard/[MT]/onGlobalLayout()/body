{
  Log.d(TAG,"onGlobalLayout");
  if (!softKeyboardListeningEnabled) {
    return;
  }
  Rect r=new Rect();
  decorView.getWindowVisibleDisplayFrame(r);
  int screenHeight=decorView.getRootView().getHeight();
  int heightDifference=screenHeight - (r.bottom - r.top);
  int widthDiff=decorView.getRootView().getWidth() - (r.right - r.left);
  if (Math.abs(widthDiff) > 0) {
    return;
  }
  int resourceId=activity.getResources().getIdentifier("status_bar_height","dimen","android");
  if (resourceId > 0) {
    heightDifference-=activity.getResources().getDimensionPixelSize(resourceId);
  }
  int orientation=activity.getResources().getConfiguration().orientation;
  int id=activity.getResources().getIdentifier("config_showNavigationBar","bool","android");
  if (id > 0) {
    if (activity.getResources().getBoolean(id)) {
      int navbarResId=activity.getResources().getIdentifier(orientation == Configuration.ORIENTATION_PORTRAIT ? "navigation_bar_height" : "navigation_bar_height_landscape","dimen","android");
      if (navbarResId > 0) {
        heightDifference-=activity.getResources().getDimensionPixelSize(navbarResId);
      }
    }
  }
  if (heightDifference > 100) {
    softwareKeyboardShowing=true;
    Log.d(TAG,"onGlobalLayout: " + heightDifference);
    keyboardHeight=heightDifference;
    if (!showRequested) {
      Log.d(TAG,"onGlobalLayout: " + "showing");
      if (showing) {
        dismiss();
      }
    }
  }
 else {
    softwareKeyboardShowing=false;
    if (showRequested) {
      showInternal();
    }
    Log.d(TAG,"onGlobalLayout: " + heightDifference);
    Log.d(TAG,"onGlobalLayout: " + "dismiss?");
  }
}
