{
  if (!isStashing) {
    throw new RuntimeException("Actor is not stashed");
  }
  isStashing=false;
  if (beforeUnstash != null) {
    beforeUnstash.run();
    beforeUnstash=null;
  }
  StashedMessage[] msgs=stashed.toArray(new StashedMessage[stashed.size()]);
  stashed.clear();
  for (int i=msgs.length - 1; i >= 0; i--) {
    self().sendFirst(msgs[i].getMessage(),msgs[i].getSender());
  }
}
