{
  final long id=RandomUtils.nextRid();
  new Promise<Object>(){
    @Override protected void exec(    @NotNull PromiseExecutor<Object> executor){
      become(new Receiver(){
        @Override public void onReceive(        Object message){
          if (message instanceof AskResult) {
            AskResult askResult=((AskResult)message);
            if (askResult.getId() != id) {
              stash();
              return;
            }
            unbecome();
            unstashAll();
            if (callback != null) {
              callback.onResult(askResult.getResult());
            }
          }
 else           if (message instanceof AskError) {
            AskError error=((AskError)message);
            if (error.getId() != id) {
              stash();
              return;
            }
            unbecome();
            unstashAll();
            if (callback != null) {
              callback.onError(error.getException());
            }
          }
 else {
            stash();
          }
        }
      }
);
      dest.send(new AskRequest(message,executor));
    }
  }
.then(new Supplier<Object>(){
    @Override public void apply(    Object o){
      self().send(new AskResult(id,o));
    }
  }
).failure(new Supplier<Exception>(){
    @Override public void apply(    Exception e){
      self().send(new AskError(id,e));
    }
  }
).done();
}
