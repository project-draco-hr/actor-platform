{
  int childCount=getChildCount();
  int idCount=0;
  int headerCount=0;
  for (int i=0; i < childCount; i++) {
    int index=getFirstVisiblePosition() + i;
    long id=getItemIdAtPosition(index);
    if (id > 0) {
      idCount++;
    }
 else {
      headerCount++;
    }
  }
  VisibleViewItem[] res=new VisibleViewItem[idCount];
  int resIndex=0;
  for (int i=0; i < childCount; i++) {
    View v=getChildAt(i);
    int index=getFirstVisiblePosition() + i;
    long id=getItemIdAtPosition(index);
    if (id > 0) {
      int top=((v == null) ? 0 : v.getTop()) - getPaddingTop();
      res[resIndex++]=new VisibleViewItem(index + headerCount,top,id);
    }
  }
  return res;
}
