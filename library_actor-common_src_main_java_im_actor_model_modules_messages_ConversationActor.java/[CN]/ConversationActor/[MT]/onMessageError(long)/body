{
  Message msg=messages.getValue(rid);
  if (msg != null && (msg.getMessageState() == MessageState.PENDING || msg.getMessageState() == MessageState.SENT)) {
    messages.addOrUpdateItem(msg.changeState(MessageState.ERROR));
    dialogsActor.send(new DialogsActor.MessageStateChanged(peer,rid,MessageState.ERROR));
  }
}
