{
  if (messages.getValue(message.getEngineId()) != null) {
    return;
  }
  messages.addOrUpdateItem(message);
  if (message.getMessageState() != MessageState.PENDING && message.getMessageState() != MessageState.ERROR) {
    dialogsActor.send(new DialogsActor.InMessage(peer,message));
  }
  if (message.getSenderId() == myUid()) {
    messagesStorage.getMessages().add(new OutUnreadMessage(message.getRid(),message.getDate()));
    savePending();
  }
}
