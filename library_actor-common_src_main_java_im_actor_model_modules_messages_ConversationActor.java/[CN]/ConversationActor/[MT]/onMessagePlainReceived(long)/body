{
  for (  OutUnreadMessage p : messagesStorage.getMessages()) {
    if (p.getDate() <= date) {
      Message msg=messages.getValue(p.getRid());
      if (msg != null && msg.getMessageState() == MessageState.SENT) {
        Message updatedMsg=msg.changeState(MessageState.RECEIVED);
        messages.addOrUpdateItem(updatedMsg);
        if (updatedMsg.getContent() instanceof PhotoContent || updatedMsg.getContent() instanceof VideoContent) {
          media.addOrUpdateItem(updatedMsg);
        }
 else {
          if (updatedMsg.getContent() instanceof DocumentContent) {
          }
        }
        dialogsActor.send(new DialogsActor.MessageStateChanged(peer,p.getRid(),MessageState.RECEIVED));
      }
    }
  }
}
