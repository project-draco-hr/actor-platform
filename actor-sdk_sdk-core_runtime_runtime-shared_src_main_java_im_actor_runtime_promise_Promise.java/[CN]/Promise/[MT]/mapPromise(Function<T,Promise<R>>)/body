{
  final Promise<T> self=this;
  return new Promise<R>(){
    @Override void exec(    final PromiseResolver<R> resolver){
      self.then(new Consumer<T>(){
        @Override public void apply(        T t){
          Promise<R> promise;
          try {
            promise=res.apply(t);
          }
 catch (          Exception e) {
            e.printStackTrace();
            resolver.tryError(e);
            return;
          }
          promise.then(new Consumer<R>(){
            @Override public void apply(            R r){
              resolver.result(r);
            }
          }
);
          promise.failure(new Consumer<Exception>(){
            @Override public void apply(            Exception e){
              resolver.error(e);
            }
          }
);
          promise.done(resolver.getDispatcher());
        }
      }
);
      self.failure(new Consumer<Exception>(){
        @Override public void apply(        Exception e){
          resolver.tryError(e);
        }
      }
);
      self.done(resolver.getDispatcher());
    }
  }
;
}
