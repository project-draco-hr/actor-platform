{
  if (item.getItemId() == R.id.editAvatar) {
    CharSequence[] args;
    if (getAvatar().getValue() != null) {
      args=new CharSequence[]{getString(R.string.pick_photo_camera),getString(R.string.pick_photo_gallery),getString(R.string.pick_photo_remove)};
    }
 else {
      args=new CharSequence[]{getString(R.string.pick_photo_camera),getString(R.string.pick_photo_gallery)};
    }
    new AlertDialog.Builder(this).setItems(args,new DialogInterface.OnClickListener(){
      @Override public void onClick(      DialogInterface dialog,      int which){
        if (which == 0) {
          externalFile=AppContext.getExternalTempFile("capture","jpg");
          if (externalFile == null) {
            Toast.makeText(ViewAvatarActivity.this,R.string.toast_no_sdcard,Toast.LENGTH_LONG).show();
            return;
          }
          startActivityForResult(new Intent(MediaStore.ACTION_IMAGE_CAPTURE).putExtra(MediaStore.EXTRA_OUTPUT,Uri.fromFile(new File(externalFile))),REQUEST_PHOTO);
        }
 else         if (which == 1) {
          Intent i=new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);
          i.setType("image/*");
          startActivityForResult(i,REQUEST_GALLERY);
        }
 else         if (which == 2) {
          if (chatType == DialogType.TYPE_USER) {
            if (chatId == myUid()) {
              AvatarChangeActor.avatarSender().clearAvatar();
            }
          }
 else           if (chatType == DialogType.TYPE_GROUP) {
            GroupAvatarActor.get().clearAvatar(chatId);
          }
        }
      }
    }
).show().setCanceledOnTouchOutside(true);
    return true;
  }
 else   if (item.getItemId() == R.id.shareAvatar) {
    DiskCache diskCache=Core.core().getImageLoader().getInternalDiskCache();
    String file=diskCache.lockFile(FileKeys.avatarKey(getAvatar().getValue().getFullImage().getFileLocation().getFileId()));
    if (file != null) {
      startActivity(Intents.shareAvatar(getAvatar().getValue().getFullImage().getFileLocation()));
    }
  }
 else   if (item.getItemId() == R.id.setAs) {
    DiskCache diskCache=Core.core().getImageLoader().getInternalDiskCache();
    String file=diskCache.lockFile(FileKeys.avatarKey(getAvatar().getValue().getFullImage().getFileLocation().getFileId()));
    if (file != null) {
      startActivity(Intents.setAsAvatar(getAvatar().getValue().getFullImage().getFileLocation()));
    }
  }
 else   if (item.getItemId() == android.R.id.home) {
    finish();
    return true;
  }
  return super.onOptionsItemSelected(item);
}
