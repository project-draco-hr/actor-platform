{
  if (requestCode == REQUEST_GALLERY && resultCode == Activity.RESULT_OK) {
    avatarPath=AppContext.getInternalTempFile("avatar","jpg");
    new Crop(data.getData()).output(Uri.fromFile(new File(avatarPath))).asSquare().start(this);
  }
 else   if (requestCode == REQUEST_PHOTO && resultCode == Activity.RESULT_OK) {
    avatarPath=AppContext.getInternalTempFile("avatar","jpg");
    new Crop(Uri.fromFile(new File(externalFile))).output(Uri.fromFile(new File(avatarPath))).asSquare().start(this);
  }
 else   if (requestCode == Crop.REQUEST_CROP && resultCode == Activity.RESULT_OK) {
    if (peer.getPeerType() == PeerType.PRIVATE) {
      if (peer.getPeerId() == myUid()) {
        messenger().changeAvatar(avatarPath);
      }
    }
 else     if (peer.getPeerType() == PeerType.GROUP) {
      messenger().changeGroupAvatar(peer.getPeerId(),avatarPath);
    }
  }
}
