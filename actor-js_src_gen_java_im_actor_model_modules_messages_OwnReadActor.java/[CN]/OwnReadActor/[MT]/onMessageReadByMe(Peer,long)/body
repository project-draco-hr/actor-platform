{
  long msgRid=0;
  long msgSortingDate=0;
  Set<UnreadMessage> unread=messagesStorage.getUnread(peer);
  for (  UnreadMessage u : unread.toArray(new UnreadMessage[0])) {
    if (u.isEncrypted()) {
      continue;
    }
    if (u.getSortDate() <= sortingDate && u.getSortDate() > msgSortingDate) {
      msgSortingDate=u.getSortDate();
      msgRid=u.getRid();
    }
  }
  if (msgSortingDate > 0) {
    onMessageRead(peer,msgRid,msgSortingDate,false);
  }
}
