{
  super.onReceive(message);
  final String path=self().getPath();
  if (message instanceof TaskRequest) {
    final TaskRequest taskRequest=(TaskRequest)message;
    taskId=taskRequest.getRequestId();
    final int currentId=taskId;
    Logger.d("ImageReceiver",path + "|RequestTask " + taskId);
    cancel();
    BitmapReference reference=loader.getMemoryCache().findInCache(taskRequest.getRequest().getKey(),this);
    if (reference != null) {
      Logger.d("ImageReceiver",path + "|Founded in cache");
      ImageReceiver r=receiver.get();
      if (r == null) {
        Logger.d("ImageReceiver",path + "|empty receiver");
        context().stopSelf();
        return;
      }
      r.onImageLoaded(new ImageLoaded(currentId,reference));
      return;
    }
    try {
      final ActorSelection selection=resolver.resolveSelection(taskRequest.getRequest());
      future=ask(selection,new AskCallback<BitmapReference>(){
        @Override public void onResult(        BitmapReference result){
          Logger.d("ImageReceiver",path + "|Work result");
          ImageReceiver r=receiver.get();
          if (r == null) {
            Logger.d("ImageReceiver",path + "|empty receiver");
            context().stopSelf();
            return;
          }
          r.onImageLoaded(new ImageLoaded(currentId,result.fork(receiver)));
        }
        @Override public void onError(        Throwable throwable){
          Logger.d("ImageReceiver",path + "|Work error: " + throwable);
          ImageReceiver r=receiver.get();
          if (r == null) {
            Logger.d("ImageReceiver",path + "|empty receiver");
            context().stopSelf();
            return;
          }
          r.onImageError(new ImageError(currentId,throwable));
        }
      }
);
      Logger.d("ImageReceiver",path + "|Requested new work @" + selection.getPath());
    }
 catch (    Exception e) {
      Logger.d("ImageReceiver",path + "|Error during resolve");
      ImageReceiver r=receiver.get();
      if (r == null) {
        Logger.d("ImageReceiver",path + "|empty receiver");
        context().stopSelf();
        return;
      }
      r.onImageError(new ImageError(currentId,e));
    }
  }
 else   if (message instanceof TaskCancel) {
    TaskCancel taskCancel=(TaskCancel)message;
    if (taskId == taskCancel.getRequestId()) {
      cancel();
    }
  }
}
