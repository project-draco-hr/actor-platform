{
  Message msg=messages.getValue(rid);
  if (msg != null && (msg.getMessageState() == MessageState.PENDING)) {
    MessageState state;
    if (date <= outReadState) {
      state=MessageState.READ;
    }
 else     if (date <= outReceiveState) {
      state=MessageState.RECEIVED;
    }
 else {
      state=MessageState.SENT;
    }
    Message updatedMsg=msg.changeAllDate(date).changeState(state);
    messages.addOrUpdateItem(updatedMsg);
    dialogsActor.send(new DialogsActor.InMessage(peer,updatedMsg,inMessagesStorage.getCount()));
    if (state != MessageState.READ) {
      outMessagesStorage.addOrUpdate(rid,date);
      saveOutPending();
    }
  }
}
