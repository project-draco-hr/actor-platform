{
  boolean isOverride=messages.getValue(message.getEngineId()) != null;
  messages.addOrUpdateItem(message);
  if (message.getMessageState() != MessageState.PENDING && message.getMessageState() != MessageState.ERROR) {
    dialogsActor.send(new DialogsActor.InMessage(peer,message));
  }
  if (message.getSenderId() == myUid() && !isOverride) {
    messagesStorage.getMessages().add(new OutUnreadMessage(message.getRid(),message.getDate()));
    savePending();
  }
}
