{
  alreadyInTemp=Storage.isAlreadyInTemp(descriptor);
  isWriteToDestProvider=Storage.isFsPersistent() && !alreadyInTemp;
  srcReference=Storage.fileFromDescriptor(descriptor);
  if (srcReference == null) {
    if (LOG) {
      Log.d(TAG,"Error during file reference creating");
    }
    reportError();
    return;
  }
  if (isWriteToDestProvider) {
    destReference=Storage.createTempFile();
    if (destReference == null) {
      if (LOG) {
        Log.w(TAG,"Error during file dest reference creating");
      }
      reportError();
      return;
    }
  }
  inputFile=srcReference.openRead();
  if (inputFile == null) {
    if (LOG) {
      Log.w(TAG,"Error during file open");
    }
    reportError();
    return;
  }
  if (isWriteToDestProvider) {
    outputFile=destReference.openWrite(srcReference.getSize());
    if (outputFile == null) {
      inputFile.close();
      if (LOG) {
        Log.w(TAG,"Error during dest file open");
      }
      reportError();
      return;
    }
  }
  crc32=new CRC32();
  startUpload();
}
