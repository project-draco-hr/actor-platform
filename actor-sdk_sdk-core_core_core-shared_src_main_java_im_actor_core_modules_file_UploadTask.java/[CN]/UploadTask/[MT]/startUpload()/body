{
  blocksCount=srcReference.getSize() / blockSize;
  if (srcReference.getSize() % blockSize != 0) {
    blocksCount++;
  }
  if (LOG) {
    Log.d(TAG,"Starting uploading " + blocksCount + " blocks");
    Log.d(TAG,"Requesting upload config...");
  }
  request(new RequestGetFileUploadUrl(srcReference.getSize()),new RpcCallback<ResponseGetFileUploadUrl>(){
    @Override public void onResult(    ResponseGetFileUploadUrl response){
      if (LOG) {
        Log.d(TAG,"Upload config loaded");
      }
      uploadConfig=response.getUploadKey();
      checkQueue();
    }
    @Override public void onError(    RpcException e){
      if (LOG) {
        Log.w(TAG,"Upload config load error");
      }
      reportError();
    }
  }
);
}
