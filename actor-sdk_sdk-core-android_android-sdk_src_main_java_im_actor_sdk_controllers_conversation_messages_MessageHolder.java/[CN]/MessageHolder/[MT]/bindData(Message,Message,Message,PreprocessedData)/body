{
  boolean isUpdated=currentMessage == null || currentMessage.getRid() != message.getRid();
  currentMessage=message;
  boolean useDiv;
  if (prev != null) {
    useDiv=!Strings.areSameDays(prev.getDate(),message.getDate());
  }
 else {
    useDiv=true;
  }
  if (useDiv) {
    container.showDate(message.getDate());
  }
 else {
    container.hideDate();
  }
  if (message.getRid() == adapter.getFirstUnread()) {
    container.showUnread();
  }
 else {
    container.hideUnread();
  }
  if (!isFullSize) {
    if (message.getSenderId() == myUid()) {
      container.makeOutboundBubble();
    }
 else {
      boolean isGroupBot=getPeer().getPeerType().equals(PeerType.GROUP) && users().get(message.getSenderId()).getName().get().equals("Bot");
      container.makeInboundBubble(getPeer().getPeerType() == PeerType.GROUP,message.getSenderId(),isGroupBot ? getPeer().getPeerId() : 0);
    }
  }
  container.setBubbleSelected(adapter.isSelected(currentMessage));
  if (onlineBinding != null) {
    getAdapter().getBinder().unbind(onlineBinding);
  }
  final UserVM user=users().get(message.getSenderId());
  onlineBinding=getAdapter().getBinder().bind(new ActorBinder.OnChangedListener<Boolean>(){
    @Override public void onChanged(    Boolean online){
      setOnline(online,user.isBot());
    }
  }
,user.getPresence());
  setOnline(user.getPresence().get().getState().equals(UserPresence.State.ONLINE),user.isBot());
  bindData(message,isUpdated,preprocessedData);
  ActorSDK.sharedActor().getMessenger().onUserVisible(message.getSenderId());
}
