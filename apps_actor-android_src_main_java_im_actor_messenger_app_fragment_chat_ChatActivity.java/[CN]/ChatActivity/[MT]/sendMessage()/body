{
  Editable mdText=messageBody.getText();
  String rawText=mdText.toString();
  ArrayList<Integer> mentions=convertUrlspansToMarkdownLinks(mdText);
  final String mdTextString=mentions.isEmpty() ? "" : mdText.toString().replace(MENTION_BOUNDS_STR,"").trim();
  rawText=rawText.replace(MENTION_BOUNDS_STR,"").trim();
  messageBody.setText("");
  mentionSearchString="";
  if (rawText.length() == 0) {
    return;
  }
  if (getResources().getDisplayMetrics().heightPixels <= getResources().getDisplayMetrics().widthPixels) {
    keyboardUtils.setImeVisibility(messageBody,false);
  }
  messenger().sendMessage(peer,rawText,mdTextString,mentions);
  messenger().trackTextSend(peer);
}
