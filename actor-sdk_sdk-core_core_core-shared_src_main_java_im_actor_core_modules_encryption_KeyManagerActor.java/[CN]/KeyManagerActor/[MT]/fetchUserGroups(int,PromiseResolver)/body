{
  final UserKeys userKeys=getCachedUserKeys(uid);
  if (userKeys != null) {
    for (    UserKeysGroup g : userKeys.getUserKeysGroups()) {
      Log.d(TAG,"Group (uid: " + uid + ") "+ g.getKeyGroupId());
    }
    future.result(new FetchUserKeyGroupsResponse(userKeys));
    return;
  }
  User user=users().getValue(uid);
  request(new RequestLoadPublicKeyGroups(new ApiUserOutPeer(uid,user.getAccessHash())),new RpcCallback<ResponsePublicKeyGroups>(){
    @Override public void onResult(    ResponsePublicKeyGroups response){
      ArrayList<UserKeysGroup> keysGroups=new ArrayList<UserKeysGroup>();
      for (      ApiEncryptionKeyGroup keyGroup : response.getPublicKeyGroups()) {
        UserKeysGroup validatedKeysGroup=validateUserKeysGroup(uid,keyGroup);
        if (validatedKeysGroup != null) {
          keysGroups.add(validatedKeysGroup);
        }
      }
      if (keysGroups.size() != 0) {
        UserKeys userKeys1=new UserKeys(uid,keysGroups.toArray(new UserKeysGroup[keysGroups.size()]));
        cacheUserKeys(userKeys1);
        future.result(new FetchUserKeyGroupsResponse(userKeys1));
      }
 else {
        Log.w(TAG,"(uid:" + uid + ") No valid key groups found");
        future.error(new RuntimeException("No key groups found"));
      }
    }
    @Override public void onError(    RpcException e){
      future.error(e);
    }
  }
);
}
