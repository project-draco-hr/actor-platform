{
  if (date <= loadLastReadState(peer)) {
    return;
  }
  boolean isEnabled=isNotificationsEnabled(peer,hasCurrentUserMention);
  if (isEnabled) {
    List<PendingNotification> allPending=getNotifications();
    allPending.add(new PendingNotification(peer,sender,date,description));
    saveStorage();
  }
  if (isNotificationsPaused) {
    notificationsDuringPause.add(peer);
    return;
  }
  if (isAppVisible) {
    if (visiblePeer != null && visiblePeer.equals(peer)) {
      if (config().getDeviceCategory() == DeviceCategory.DESKTOP || config().getDeviceCategory() == DeviceCategory.TABLET) {
      }
 else {
        if (isEffectsEnabled()) {
          playEffect();
        }
      }
    }
 else {
      if (config().getDeviceCategory() == DeviceCategory.DESKTOP || config().getDeviceCategory() == DeviceCategory.TABLET) {
        if (isEnabled) {
          if (isEffectsEnabled()) {
            playEffect();
          }
        }
      }
 else {
      }
    }
  }
 else {
    if (isEnabled) {
      showNotification();
    }
  }
}
