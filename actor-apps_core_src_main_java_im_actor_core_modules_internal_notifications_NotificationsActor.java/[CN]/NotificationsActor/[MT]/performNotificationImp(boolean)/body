{
  List<PendingNotification> allPending=getNotifications();
  int messagesCount=allPending.size();
  if (messagesCount == 0) {
    hideNotification();
    return;
  }
  List<PendingNotification> destNotifications=last(allPending,MAX_NOTIFICATION_COUNT);
  List<Notification> res=new ArrayList<Notification>();
  for (  PendingNotification p : destNotifications) {
    res.add(new Notification(p.getPeer(),p.getSender(),p.getContent()));
  }
  HashSet<Peer> peers=new HashSet<Peer>();
  for (  PendingNotification p : allPending) {
    peers.add(p.getPeer());
  }
  int chatsCount=peers.size();
  if (performUpdate) {
    config().getNotificationProvider().onUpdateNotification(context().getMessenger(),res,messagesCount,chatsCount);
  }
 else {
    config().getNotificationProvider().onNotification(context().getMessenger(),res,messagesCount,chatsCount);
  }
}
