{
  boolean isUpdated=currentMessage == null || currentMessage.getRid() != message.getRid();
  currentMessage=message;
  boolean useDiv;
  if (prev != null) {
    useDiv=!TextUtils.areSameDays(prev.getDate(),message.getDate());
  }
 else {
    useDiv=true;
  }
  if (useDiv) {
    container.showDate(message.getDate());
  }
 else {
    container.hideDate();
  }
  if (message.getRid() == fragment.getFirstUnread()) {
    container.showUnread();
  }
 else {
    container.hideUnread();
  }
  if (!isFullSize) {
    if (message.getSenderId() == myUid()) {
      container.makeOutboundBubble();
    }
 else {
      container.makeInboundBubble(getPeer().getPeerType() == PeerType.GROUP,message.getSenderId());
    }
  }
  container.setBubbleSelected(fragment.isSelected(currentMessage.getRid()));
  bindData(message,isUpdated);
  fragment.onItemViewed(message);
}
