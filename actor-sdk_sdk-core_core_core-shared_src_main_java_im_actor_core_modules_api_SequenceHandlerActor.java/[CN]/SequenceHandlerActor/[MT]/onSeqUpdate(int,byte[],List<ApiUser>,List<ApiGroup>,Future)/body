{
  Update update;
  try {
    update=new UpdatesParser().read(type,body);
  }
 catch (  IOException e) {
    Log.w(TAG,"Unable to parse update: ignoring");
    Log.e(TAG,e);
    future.onResult();
    return;
  }
  if (groups == null || users == null) {
    if (processor.isCausesInvalidation(update)) {
      Log.w(TAG,"Difference is required");
      future.onError(new RuntimeException("Difference is required"));
      return;
    }
  }
  Log.d(TAG,"Processing update: " + update);
  if (groups != null && users != null) {
    processor.applyRelated(users,groups,false);
  }
  processor.processUpdate(update);
  if (groups != null && users != null) {
    processor.applyRelated(users,groups,true);
  }
  Log.d(TAG,"Processing update success");
  future.onResult();
}
