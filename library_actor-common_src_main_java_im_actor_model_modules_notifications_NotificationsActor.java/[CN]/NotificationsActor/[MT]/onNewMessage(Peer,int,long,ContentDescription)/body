{
  boolean isEnabled=modules().getSettings().isNotificationsEnabled(peer);
  List<PendingNotification> allPending=getNotifications();
  if (isEnabled) {
    allPending.add(new PendingNotification(peer,sender,date,description));
    saveStorage();
  }
  if (config().getNotificationProvider() != null) {
    if (visiblePeer != null && visiblePeer.equals(peer)) {
      if (modules().getSettings().isConversationTonesEnabled()) {
        config().getNotificationProvider().onMessageArriveInApp(modules().getMessenger());
      }
      return;
    }
    if (isDialogsVisible) {
      if (modules().getSettings().isConversationTonesEnabled()) {
        config().getNotificationProvider().onMessageArriveInApp(modules().getMessenger());
      }
      return;
    }
    if (!isEnabled) {
      return;
    }
    performNotification(false);
  }
}
