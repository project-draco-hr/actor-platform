{
  long key=root.buildKey(time);
  long oldKey;
synchronized (envelopes) {
    oldKey=topKey;
    envelopes.put(key,new ScheduledEnvelope(key,time,envelope));
    if (key < topKey || topKey == 0) {
      topKey=key;
    }
  }
  if (oldKey != topKey) {
    root.changedTopKey(this);
  }
  return key;
}
