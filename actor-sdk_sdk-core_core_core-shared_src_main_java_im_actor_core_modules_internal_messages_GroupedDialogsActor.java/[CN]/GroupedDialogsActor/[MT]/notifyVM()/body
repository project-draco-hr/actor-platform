{
  ArrayList<DialogGroup> groups=new ArrayList<DialogGroup>();
  for (  GroupedItem i : storage.getGroups()) {
    ArrayListDialogSmall dialogSmalls=new ArrayListDialogSmall();
    for (    Peer p : i.getPeers()) {
      DialogSpec spec=specs.getEngine().getValue(p.getUnuqueId());
      String title;
      Avatar avatar;
      if (p.getPeerType() == PeerType.GROUP) {
        Group group=getGroup(p.getPeerId());
        if (group == null) {
          continue;
        }
        title=group.getTitle();
        avatar=group.getAvatar();
      }
 else       if (p.getPeerType() == PeerType.PRIVATE) {
        User user=getUser(p.getPeerId());
        if (user == null) {
          continue;
        }
        title=user.getName();
        avatar=user.getAvatar();
      }
 else {
        continue;
      }
      dialogSmalls.add(new DialogSmall(p,title,avatar,spec.getCounter()));
    }
    groups.add(new DialogGroup(i.getTitle(),i.getKey(),dialogSmalls));
  }
  context().getMessagesModule().getDialogGroupsVM().getGroupsValueModel().change(groups);
}
