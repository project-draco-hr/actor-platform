{
  if (init || isLoading) {
    if (lastCallback != null) {
      lastCallback.onError(new RpcException(TAG,0,"callback replaced",false,null));
    }
  }
  lastCallback=callback;
  if (isLoading && !init) {
    return;
  }
  if (init) {
    if (lastRequest != -1) {
      cancelRequest(lastRequest);
    }
    nextOffset=null;
  }
  isLoading=true;
  Log.d(TAG,"Loading archived dialogs");
  lastRequest=request(new RequestLoadArchived(nextOffset,LIMIT),new RpcCallback<ResponseLoadArchived>(){
    @Override public void onResult(    final ResponseLoadArchived response){
      updates().applyRelatedData(response.getUsers(),response.getGroups()).then(new Consumer<Void>(){
        @Override public void apply(        Void aVoid){
          onLoadedMore(response);
        }
      }
);
    }
    @Override public void onError(    RpcException e){
      lastCallback.onError(e);
    }
  }
);
}
