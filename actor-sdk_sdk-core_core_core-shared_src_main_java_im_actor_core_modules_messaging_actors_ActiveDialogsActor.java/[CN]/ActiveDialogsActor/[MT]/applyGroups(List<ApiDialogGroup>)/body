{
  ArrayList<DialogSpec> updatedSpecs=new ArrayList<DialogSpec>();
  for (  ApiDialogGroup g : dialogGroups) {
    for (    ApiDialogShort s : g.getDialogs()) {
      Peer peer=convert(s.getPeer());
      if (specs.getEngine().getValue(peer.getUnuqueId()) == null) {
        updatedSpecs.add(new DialogSpec(peer,false,s.getCounter()));
      }
    }
  }
  specs.getEngine().addOrUpdateItems(updatedSpecs);
  storage.getGroups().clear();
  for (  ApiDialogGroup g : dialogGroups) {
    ArrayList<Peer> peers=new ArrayList<Peer>();
    for (    ApiDialogShort s : g.getDialogs()) {
      Peer peer=convert(s.getPeer());
      peers.add(peer);
    }
    storage.getGroups().add(new GroupedItem(g.getKey(),g.getTitle(),peers));
  }
  preferences().putBytes(PREFERENCE_GROUPED,storage.toByteArray());
  notifyVM();
}
