{
  Command<ResponseGetPublicGroups> cmd=messenger().executeExternalCommand(new RequestGetPublicGroups());
  if (cmd != null)   cmd.start(new CommandCallback<ResponseGetPublicGroups>(){
    @Override public void onResult(    ResponseGetPublicGroups res){
      final ArrayList<PublicGroup> groups=new ArrayList<PublicGroup>();
      for (      im.actor.model.api.PublicGroup g : res.getGroups()) {
        groups.add(new PublicGroup(g));
      }
      getActivity().runOnUiThread(new Runnable(){
        @Override public void run(){
          ArrayList<PublicGroup> sortedGroups=new ArrayList<PublicGroup>(groups);
          Collections.sort(sortedGroups,new Comparator<PublicGroup>(){
            @Override public int compare(            PublicGroup lhs,            PublicGroup rhs){
              if (lhs.getMembersCount() < rhs.getMembersCount()) {
                return 1;
              }
 else               if (lhs.getMembersCount() > rhs.getMembersCount()) {
                return -1;
              }
              return 0;
            }
          }
);
          ArrayList<PublicGroup> groupsSet=new ArrayList<PublicGroup>();
          groupsSet.add(sortedGroups.get(0));
          groupsSet.add(sortedGroups.get(1));
          groupsSet.add(sortedGroups.get(2));
          PublicGroupSetView groupSetView=new PublicGroupSetView(getActivity(),new PublicGroupSet(groupsSet,getString(R.string.join_public_group_top_title),getString(R.string.join_public_group_top_subtitle)));
          groupSetView.setOnGroupClickListener(new PublicGroupSetView.GroupClickListener(){
            @Override public void onClick(            PublicGroup group){
              openGroup(group);
            }
          }
);
          listView.addHeaderView(groupSetView,null,false);
          adapter.updateGroups(groups);
          hideView(emptyView);
          showView(listView);
        }
      }
);
    }
    @Override public void onError(    Exception e){
    }
  }
);
  final View res=inflater.inflate(R.layout.fragment_list,container,false);
  listView=(ListView)res.findViewById(R.id.listView);
  emptyView=(TextView)res.findViewById(R.id.emptyView);
  emptyView.setText(getString(R.string.picker_loading));
  adapter=new JoinPublicGroupAdapter(new ArrayList<PublicGroup>(),getActivity());
  listView.setAdapter(adapter);
  listView.setOnItemClickListener(new AdapterView.OnItemClickListener(){
    @Override public void onItemClick(    AdapterView<?> parent,    View view,    int position,    long id){
      final PublicGroup item=(PublicGroup)parent.getItemAtPosition(position);
      openGroup(item);
    }
  }
);
  return res;
}
