{
  super.preStart();
  conversationStates=context().getMessagesModule().getConversationStates().getEngine();
  activeDialogStorage=new ActiveDialogStorage();
  byte[] data=context().getStorageModule().getBlobStorage().loadItem(AbsModule.BLOB_DIALOGS_ACTIVE);
  if (data != null) {
    try {
      activeDialogStorage=new ActiveDialogStorage(data);
    }
 catch (    IOException e) {
      e.printStackTrace();
    }
  }
  if (!activeDialogStorage.isLoaded()) {
    api(new RequestLoadGroupedDialogs()).then(new Consumer<ResponseLoadGroupedDialogs>(){
      @Override public void apply(      final ResponseLoadGroupedDialogs responseLoadGroupedDialogs){
        updates().applyRelatedData(responseLoadGroupedDialogs.getUsers(),responseLoadGroupedDialogs.getGroups()).then(new Consumer<Void>(){
          @Override public void apply(          Void aVoid){
            boolean showArchived=false;
            boolean showInvite=false;
            if (responseLoadGroupedDialogs.showArchived() != null) {
              showArchived=responseLoadGroupedDialogs.showArchived();
            }
            if (responseLoadGroupedDialogs.showInvite() != null) {
              showInvite=responseLoadGroupedDialogs.showInvite();
            }
            onActiveDialogsChanged(responseLoadGroupedDialogs.getDialogs(),showArchived,showInvite);
          }
        }
).done(self());
      }
    }
).done(self());
  }
 else {
    notifyActiveDialogsVM();
  }
}
