{
  Message msg=messages.getValue(rid);
  if (msg != null && (msg.getMessageState() == MessageState.PENDING)) {
    for (    OutUnreadMessage p : messagesStorage.getMessages()) {
      if (p.getRid() == rid) {
        messagesStorage.getMessages().remove(p);
        messagesStorage.getMessages().add(new OutUnreadMessage(rid,date));
        break;
      }
    }
    savePending();
    messages.addOrUpdateItem(msg.changeDate(date).changeState(MessageState.SENT));
    dialogsActor.send(new DialogsActor.MessageSent(peer,rid,date));
  }
}
