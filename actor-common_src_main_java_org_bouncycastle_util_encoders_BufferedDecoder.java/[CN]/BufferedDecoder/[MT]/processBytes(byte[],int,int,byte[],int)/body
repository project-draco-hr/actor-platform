{
  if (len < 0) {
    throw new IllegalArgumentException("Can't have a negative input length!");
  }
  int resultLen=0;
  int gapLen=buf.length - bufOff;
  if (len > gapLen) {
    System.arraycopy(in,inOff,buf,bufOff,gapLen);
    resultLen+=translator.decode(buf,0,buf.length,out,outOff);
    bufOff=0;
    len-=gapLen;
    inOff+=gapLen;
    outOff+=resultLen;
    int chunkSize=len - (len % buf.length);
    resultLen+=translator.decode(in,inOff,chunkSize,out,outOff);
    len-=chunkSize;
    inOff+=chunkSize;
  }
  if (len != 0) {
    System.arraycopy(in,inOff,buf,bufOff,len);
    bufOff+=len;
  }
  return resultLen;
}
