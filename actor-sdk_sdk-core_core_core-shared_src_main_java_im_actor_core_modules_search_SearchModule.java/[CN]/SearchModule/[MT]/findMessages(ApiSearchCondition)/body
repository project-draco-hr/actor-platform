{
  return new Command<List<MessageSearchEntity>>(){
    @Override public void start(    final CommandCallback<List<MessageSearchEntity>> callback){
      request(new RequestMessageSearch(condition),new RpcCallback<ResponseMessageSearchResponse>(){
        @Override public void onResult(        final ResponseMessageSearchResponse response){
          updates().executeRelatedResponse(response.getUsers(),response.getGroups(),new Runnable(){
            @Override public void run(){
              final ArrayList<MessageSearchEntity> res=new ArrayList<MessageSearchEntity>();
              for (              ApiMessageSearchItem r : response.getSearchResults()) {
                ApiMessageSearchResult itm=r.getResult();
                res.add(new MessageSearchEntity(convert(itm.getPeer()),itm.getRid(),itm.getDate(),itm.getSenderId(),AbsContent.fromMessage(itm.getContent())));
              }
              runOnUiThread(new Runnable(){
                @Override public void run(){
                  callback.onResult(res);
                }
              }
);
            }
          }
);
        }
        @Override public void onError(        final RpcException e){
          runOnUiThread(new Runnable(){
            @Override public void run(){
              callback.onError(e);
            }
          }
);
        }
      }
);
    }
  }
;
}
