{
  this.configuration=configuration;
  long start=configuration.getThreadingProvider().getActorTime();
  this.i18nEngine=new I18nEngine(configuration.getLocaleProvider(),this);
  Log.d("CORE_INIT","Loading stage5.1 in " + (configuration.getThreadingProvider().getActorTime() - start) + " ms");
  this.preferences=configuration.getStorageProvider().createPreferencesStorage();
  Log.d("CORE_INIT","Loading stage5.2 in " + (configuration.getThreadingProvider().getActorTime() - start) + " ms");
  start=configuration.getThreadingProvider().getActorTime();
  this.actorApi=new ActorApi(new Endpoints(configuration.getEndpoints()),new PreferenceApiStorage(preferences),new ActorApiCallback(){
    @Override public void onAuthIdInvalidated(    long authKey){
    }
    @Override public void onNewSessionCreated(){
      if (updates != null) {
        updates.onNewSessionCreated();
      }
      if (presence != null) {
        presence.onNewSessionCreated();
      }
    }
    @Override public void onUpdateReceived(    Object obj){
      if (updates != null) {
        updates.onUpdateReceived(obj);
      }
    }
  }
,configuration.getNetworkProvider());
  Log.d("CORE_INIT","Loading stage5.3 in " + (configuration.getThreadingProvider().getActorTime() - start) + " ms");
  start=configuration.getThreadingProvider().getActorTime();
  this.auth=new Auth(this);
  Log.d("CORE_INIT","Loading stage5.4 in " + (configuration.getThreadingProvider().getActorTime() - start) + " ms");
  start=configuration.getThreadingProvider().getActorTime();
}
