{
  if (silentUpdate) {
    return;
  }
  String peerTitle;
  String peerAvatarUrl=null;
  String contentMessage="";
  Notification notification=topNotifications.get(0);
  if (conversationsCount == 1) {
    Avatar peerAvatar;
    if (notification.getPeer().getPeerType() == PeerType.PRIVATE) {
      UserVM userVM=messenger.getUsers().get(notification.getPeer().getPeerId());
      peerTitle=userVM.getName().get();
      peerAvatar=userVM.getAvatar().get();
    }
 else {
      GroupVM groupVM=messenger.getGroups().get(notification.getPeer().getPeerId());
      peerTitle=groupVM.getName().get();
      peerAvatar=groupVM.getAvatar().get();
    }
    if (peerAvatar != null && peerAvatar.getSmallImage() != null) {
      peerAvatarUrl=((JsMessenger)messenger).getFileUrl(peerAvatar.getSmallImage().getFileReference());
    }
  }
 else {
    peerTitle="New messages";
    peerAvatarUrl="assets/img/notification_icon_512.png";
  }
  int nCount=Math.min(topNotifications.size(),5);
  boolean showCounters=false;
  if (topNotifications.size() > 5) {
    nCount--;
    showCounters=true;
  }
  if (conversationsCount == 1) {
    for (int i=0; i < nCount; i++) {
      Notification n=topNotifications.get(i);
      if (contentMessage.length() > 0) {
        contentMessage+="\n";
      }
      if (notification.getPeer().getPeerType() == PeerType.GROUP) {
        contentMessage+=messenger.getUsers().get(notification.getSender()).getName().get() + ": ";
      }
      contentMessage+=messenger.getFormatter().formatContentText(n.getSender(),n.getContentDescription().getContentType(),n.getContentDescription().getText(),n.getContentDescription().getRelatedUser());
    }
    if (showCounters) {
      contentMessage+="\n+" + (messagesCount - 4) + " new messages";
    }
  }
 else {
    for (int i=0; i < nCount; i++) {
      Notification n=topNotifications.get(i);
      if (contentMessage.length() > 0) {
        contentMessage+="\n";
      }
      String senderName=messenger.getUser(notification.getSender()).getName().get();
      if (notification.getPeer().getPeerType() == PeerType.GROUP) {
        String groupName=messenger.getGroup(notification.getPeer().getPeerId()).getName().get();
        contentMessage+="[" + groupName + "] "+ senderName+ ": ";
      }
 else {
        contentMessage+=senderName + ": ";
      }
      contentMessage+=messenger.getFormatter().formatContentText(n.getSender(),n.getContentDescription().getContentType(),n.getContentDescription().getText(),n.getContentDescription().getRelatedUser());
    }
    if (showCounters) {
      contentMessage+="\n+" + (messagesCount - 4) + " new messages in "+ conversationsCount+ " conversations";
    }
  }
  if (currentNotification != null) {
    currentNotification.close();
    currentNotification=null;
  }
  if (!JsNotification.isSupported()) {
    return;
  }
  if (!JsNotification.isGranted()) {
    return;
  }
  currentNotification=JsNotification.create(peerTitle,contentMessage,peerAvatarUrl);
  playSound();
}
