{
  if (getEngine().getListState().getValue().getState() == ListState.State.LOADED) {
    if (position > getCount() - LOAD_GAP) {
    }
  }
  this.bindedItem=data;
  avatar.unbind();
  avatar.setEmptyDrawable(AvatarDrawable.create(data,24,context));
  if (data.getAvatar() != null && data.getAvatar().getSmallImage() != null) {
    avatar.bindAvatar(54,data.getAvatar());
  }
  if (data.getUnreadCount() > 0) {
    counter.setText("" + data.getUnreadCount());
    counter.setVisibility(View.VISIBLE);
  }
 else {
    counter.setVisibility(View.GONE);
  }
  title.setText(data.getDialogTitle());
  int right=0;
  int left=0;
  if (!NotificationSettings.getInstance().convValue(DialogUids.getDialogUid(data)).getValue()) {
    right=R.drawable.dialogs_mute;
  }
  if (data.getType() == DialogType.TYPE_GROUP) {
    left=R.drawable.dialogs_group;
  }
  title.setCompoundDrawablesWithIntrinsicBounds(left,0,right,0);
  time.setText(Formatter.formatShortDate(data.getTime()));
  boolean isGroup=data.getType() == DialogType.TYPE_GROUP;
  if (data.getMessageType() == MessageType.TEXT) {
    bindedText=MessageTextFormatter.textMessage(data.getSenderId(),isGroup,data.getText());
  }
 else   if (data.getMessageType() == MessageType.PHOTO) {
    bindedText=MessageTextFormatter.photoMessage(data.getSenderId(),isGroup);
  }
 else   if (data.getMessageType() == MessageType.VIDEO) {
    bindedText=MessageTextFormatter.videoMessage(data.getSenderId(),isGroup);
  }
 else   if (data.getMessageType() == MessageType.DOC) {
    bindedText=MessageTextFormatter.documentMessage(data.getSenderId(),isGroup);
  }
 else   if (data.getMessageType() == MessageType.AUDIO) {
    bindedText=MessageTextFormatter.audioMessage(data.getSenderId(),isGroup);
  }
 else   if (data.getMessageType() == MessageType.USER_REGISTERED) {
    bindedText=MessageTextFormatter.joinedActor(data.getSenderId());
  }
 else   if (data.getMessageType() == MessageType.USER_ADDED_DEVICE) {
    bindedText=MessageTextFormatter.newDevice(data.getSenderId());
  }
 else   if (data.getMessageType() == MessageType.GROUP_CREATED) {
    bindedText=MessageTextFormatter.groupCreated(data.getSenderId());
  }
 else   if (data.getMessageType() == MessageType.GROUP_USER_LEAVE) {
    bindedText=MessageTextFormatter.groupLeave(data.getSenderId());
  }
 else   if (data.getMessageType() == MessageType.GROUP_USER_ADD) {
    bindedText=MessageTextFormatter.groupAdd(data.getSenderId(),data.getRelatedUid());
  }
 else   if (data.getMessageType() == MessageType.GROUP_USER_KICK) {
    bindedText=MessageTextFormatter.groupKicked(data.getSenderId(),data.getRelatedUid());
  }
 else   if (data.getMessageType() == MessageType.GROUP_TITLE) {
    bindedText=MessageTextFormatter.groupChangeTitle(data.getSenderId());
  }
 else   if (data.getMessageType() == MessageType.GROUP_AVATAR) {
    bindedText=MessageTextFormatter.groupChangeAvatar(data.getSenderId());
  }
 else   if (data.getMessageType() == MessageType.GROUP_AVATAR_REMOVED) {
    bindedText=MessageTextFormatter.groupRemoveAvatar(data.getSenderId());
  }
 else {
    bindedText="";
  }
  if (privateTypingListener != null) {
    TypingModel.privateChatTyping(bindedUid).removeUiSubscriber(privateTypingListener);
    privateTypingListener=null;
  }
  if (groupTypingListener != null) {
    TypingModel.groupChatTyping(bindedGid).removeUiSubscriber(groupTypingListener);
    groupTypingListener=null;
  }
  if (data.getType() == DialogType.TYPE_USER) {
    bindedUid=data.getId();
    privateTypingListener=new ValueChangeListener<Boolean>(){
      @Override public void onChanged(      Boolean value){
        if (value) {
          text.setText(R.string.typing_private);
          text.setTextColor(context.getResources().getColor(R.color.primary));
        }
 else {
          text.setText(bindedText);
          text.setTextColor(getContext().getResources().getColor(R.color.text_primary));
        }
      }
    }
;
    TypingModel.privateChatTyping(data.getId()).addUiSubscriber(privateTypingListener);
  }
 else   if (data.getType() == DialogType.TYPE_GROUP) {
    bindedGid=data.getId();
    groupTypingListener=new ValueChangeListener<int[]>(){
      @Override public void onChanged(      int[] value){
        if (value.length != 0) {
          text.setText(Formatter.formatTyping(value));
          text.setTextColor(context.getResources().getColor(R.color.primary));
        }
 else {
          text.setText(bindedText);
          text.setTextColor(getContext().getResources().getColor(R.color.text_primary));
        }
      }
    }
;
    TypingModel.groupChatTyping(bindedGid).addUiSubscriber(groupTypingListener);
  }
 else {
    text.setText(bindedText);
    text.setTextColor(getContext().getResources().getColor(R.color.text_primary));
  }
  if (data.getSenderId() != myUid()) {
    state.setVisibility(View.GONE);
  }
 else {
switch (data.getStatus()) {
default :
case PENDING:
      state.setResource(R.drawable.msg_clock);
    state.setTint(pendingColor);
  break;
case SENT:
state.setResource(R.drawable.msg_check_1);
state.setTint(sentColor);
break;
case RECEIVED:
state.setResource(R.drawable.msg_check_2);
state.setTint(receivedColor);
break;
case READ:
state.setResource(R.drawable.msg_check_2);
state.setTint(readColor);
break;
case ERROR:
state.setResource(R.drawable.msg_error);
state.setTint(errorColor);
break;
}
state.setVisibility(View.VISIBLE);
}
if (position == getCount() - 1) {
separator.setVisibility(View.GONE);
}
 else {
separator.setVisibility(View.VISIBLE);
}
}
