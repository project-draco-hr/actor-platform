{
  try {
    cipher.init(Cipher.ENCRYPT_MODE,cipherKeySpec);
    mac.init(macKeySpec);
    byte[] ciphertext=cipher.doFinal(plainText);
    byte[] iv=cipher.getIV();
    mac.update(iv);
    byte[] macValue=mac.doFinal(ciphertext);
    return Utils.concat(iv,ciphertext,macValue);
  }
 catch (  IllegalBlockSizeException e) {
    throw new RuntimeException(e);
  }
catch (  BadPaddingException e) {
    throw new RuntimeException(e);
  }
catch (  InvalidKeyException e) {
    throw new RuntimeException(e);
  }
}
