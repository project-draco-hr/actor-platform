{
  Log.d(TAG,"- Checking queue");
  int activeDownloads=0;
  for (  QueueItem queueItem : queue) {
    if (queueItem.isStarted) {
      activeDownloads++;
    }
  }
  if (activeDownloads >= SIM_MAX_DOWNLOADS) {
    Log.d(TAG,"- Already have max number of simultaneous downloads");
    return;
  }
  QueueItem pendingQueue=null;
  for (  QueueItem queueItem : queue) {
    if (!queueItem.isStarted && !queueItem.isStopped) {
      pendingQueue=queueItem;
      break;
    }
  }
  if (pendingQueue == null) {
    Log.d(TAG,"- No work for downloading");
    return;
  }
  Log.d(TAG,"- Starting download file #" + pendingQueue.fileLocation.getFileId());
  pendingQueue.isStarted=true;
  final QueueItem finalPendingQueue=pendingQueue;
  pendingQueue.taskRef=system().actorOf(Props.create(DownloadTask.class,new ActorCreator<DownloadTask>(){
    @Override public DownloadTask create(){
      return new DownloadTask(finalPendingQueue.fileLocation,self(),modules());
    }
  }
),"actor/download/task_" + finalPendingQueue.fileLocation.getFileId());
}
