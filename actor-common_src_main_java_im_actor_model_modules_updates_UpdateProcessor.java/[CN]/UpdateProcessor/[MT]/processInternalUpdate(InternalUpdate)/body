{
  if (update instanceof DialogHistoryLoaded) {
    ResponseLoadDialogs dialogs=((DialogHistoryLoaded)update).getDialogs();
    applyRelated(dialogs.getUsers(),dialogs.getGroups(),null,false);
    messagesProcessor.onDialogsLoaded(dialogs);
  }
 else   if (update instanceof LoggedIn) {
    ArrayList<User> users=new ArrayList<User>();
    users.add(((LoggedIn)update).getAuth().getUser());
    applyRelated(users,new ArrayList<Group>(),((LoggedIn)update).getAuth().getContacts(),true);
    runOnUiThread(((LoggedIn)update).getRunnable());
  }
 else   if (update instanceof ContactsLoaded) {
    ContactsLoaded contactsLoaded=(ContactsLoaded)update;
    applyRelated(contactsLoaded.getContacts().getUsers(),new ArrayList<Group>(),new ArrayList<ContactRecord>(),false);
    modules().getContactsModule().getContactSyncActor().send(new ContactsSyncActor.ContactsLoaded(contactsLoaded.getContacts()));
  }
 else   if (update instanceof UsersFounded) {
    final UsersFounded founded=(UsersFounded)update;
    applyRelated(((UsersFounded)update).getUsers(),new ArrayList<Group>(),new ArrayList<ContactRecord>(),false);
    final ArrayList<UserVM> users=new ArrayList<UserVM>();
    for (    User u : founded.getUsers()) {
      users.add(modules().getUsersModule().getUsersCollection().get(u.getId()));
    }
    runOnUiThread(new Runnable(){
      @Override public void run(){
        founded.getCommandCallback().onResult(users.toArray(new UserVM[users.size()]));
      }
    }
);
  }
}
