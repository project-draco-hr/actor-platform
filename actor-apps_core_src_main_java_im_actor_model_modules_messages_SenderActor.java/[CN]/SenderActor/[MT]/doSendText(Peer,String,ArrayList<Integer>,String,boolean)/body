{
  text=text.trim();
  long rid=RandomUtils.nextRid();
  long date=createPendingDate();
  long sortDate=date + 365 * 24 * 60* 60* 1000L;
  if (autoDetect) {
    mentions=new ArrayList<Integer>();
    if (peer.getPeerType() == PeerType.GROUP) {
      Group group=getGroup(peer.getPeerId());
      for (      GroupMember member : group.getMembers()) {
        User user=getUser(member.getUid());
        if (user.getNick() != null) {
          String nick="@" + user.getNick();
          if (text.contains(nick + ":") || text.contains(nick + " ") || text.contains(" " + nick)|| text.endsWith(nick)|| text.equals(nick)) {
            mentions.add(user.getUid());
          }
        }
      }
    }
  }
  TextContent content=TextContent.create(text,markDownText,mentions);
  Message message=new Message(rid,sortDate,date,myUid(),MessageState.PENDING,content);
  getConversationActor(peer).send(message);
  pendingMessages.getPendingMessages().add(new PendingMessage(peer,rid,content));
  savePending();
  performSendContent(peer,rid,content);
}
